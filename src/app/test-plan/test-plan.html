<div class="container">
  <h2>TFK</h2>

  <form [formGroup]="testPlanForm">
    <div class="form-group">
      <label>Teszt neve</label>
      <input formControlName="title" type="text" placeholder="Pl.: Bel√©p√©si folyamat" />
    </div>

    <div class="import-card">
      <div class="import-card__header">
        <div class="import-card__icon">üì•</div>
        <div>
          <h3 class="import-card__title">Excel import</h3>
          <p class="import-card__subtitle">V√°laszd ki a f√°jlt √©s a munkalapot, majd import√°lj.</p>
        </div>
      </div>

      <div class="import-card__body">
        <div class="form-group">
          <label>Import√°l√°s megl√©v≈ë Excel f√°jlb√≥l</label>
          <input type="file" accept=".xlsx,.xls" (change)="onFileSelected($event)"/>
          <small class="hint">Elfogadott form√°tum: .xlsx, .xls</small>
        </div>

        <div class="form-row grid-cols-2" *ngIf="sheetNames.length > 0">
          <div class="form-group">
            <label>Munkalap kiv√°laszt√°sa</label>
            <select [(ngModel)]="selectedSheetName"
                    [ngModelOptions]="{standalone: true}">
              <option *ngFor="let n of sheetNames" [value]="n">{{ n }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Olvas√°s kezdete (sorsz√°m)</label>
            <input type="number"
                  [ngModel]="startRow"
                  (ngModelChange)="startRow = $event"
                  [ngModelOptions]="{standalone: true}"
                  min="1" />
            <small class="hint">Default: 19</small>
          </div>
        </div>
      </div>

      <div class="import-card__footer" *ngIf="sheetNames.length > 0">
        <button type="button" class="add-step" (click)="importFromSelectedSheet()">
          Import
        </button>
      </div>
    </div>

    <div formArrayName="steps">
      <div *ngFor="let step of steps.controls; let i = index" [formGroupName]="i" class="step-card">
        <div class="step-header-row">
          <h3 class="step-header">{{ i + 1 }}. l√©p√©s</h3>

          <label class="switch">
            <input type="checkbox" formControlName="isSubtest">
            <span class="slider"></span>
            <span class="switch-label">Alteszt c√≠msor</span>
          </label>
        </div>

        <div class="form-group" *ngIf="step.get('isSubtest')?.value; else normalRow">
          <label>Alteszt neve</label>
          <input formControlName="subtestName" type="text" placeholder="Pl.: K√∂zgy√≥gyell√°t√°s szerkeszt√©s - alteszt blokk" />
        </div>

        <ng-template #normalRow>
          <div class="grid-cols-2">
            <div class="form-group">
              <label>Funkci√≥</label>
              <input formControlName="function" type="text" />
            </div>
            <div class="form-group">
              <label>El≈ëfelt√©tel</label>
              <input formControlName="precondition" type="text" />
            </div>
          </div>

          <div class="form-group">
            <label>Feladat/Tesztl√©p√©sek</label>
            <textarea formControlName="stepsText" rows="6" placeholder="√çrd le a l√©p√©seket, list√°zva"></textarea>
          </div>
          <div class="form-group">
            <label>Tesztadatok</label>
            <textarea formControlName="testData" rows="6" placeholder="√çrd le a tesztadatokat"></textarea>
          </div>
          <div class="form-group">
            <label>Elv√°rt eredm√©ny</label>
            <textarea formControlName="expected" rows="6" placeholder="√çrd le az elv√°rt kimenetet"></textarea>
          </div>
        </ng-template>

        <button type="button" class="remove-step" (click)="removeStep(i)" [disabled]="steps.length === 1">Sor t√∂rl√©se</button>
      </div>
    </div>

    <div class="actions">
      <button type="button" class="add-step" (click)="addStep()">√öj l√©p√©s hozz√°ad√°sa</button>
      <button type="button" class="add-step" (click)="exportExcel()">Export Excel</button>
    </div>
  </form>
</div>